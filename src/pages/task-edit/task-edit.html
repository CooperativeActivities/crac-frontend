<!--
  Generated template for the TaskEditPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar>
    <ion-title>{{pageTitle}}</ion-title>
    <ion-buttons end>
      <button ion-button icon-only (click)="save_changes()">
        <ion-icon name="checkmark"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

</ion-header>


<ion-content>
  <form name="taskForm" onsubmit="event.preventDefault" novalidate>
    <ion-card>
      <ion-card-content>
        <ion-grid radio-group [(ngModel)]="task.taskType" name="type" *ngIf="isNewTask" class="form-group">
          <ion-row>
            <ion-col no-padding>
              <ion-item>
                <ion-label>Übersicht</ion-label>
                <ion-radio value="ORGANISATIONAL"></ion-radio>
              </ion-item>
            </ion-col>
            <ion-col no-padding>
              <ion-item>
                <ion-label>Aufgabe</ion-label>
                <ion-radio value="WORKABLE"></ion-radio>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        Basisinformationen
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-label stacked>Titel*</ion-label>
            <ion-input type="text" [(ngModel)]="task.name" name="name" style="background-color:white;"
                       aria-describedby="inputError2Status" class="form-control" required></ion-input>
            <!-- @TODO reimplement validation
            <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"
                  *ngIf="taskForm.name.$dirty && taskForm.name.$invalid"></span>
            <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"
                  *ngIf="taskForm.name.$dirty && taskForm.name.$valid"></span>
            <span id="inputError2Status" class="help-block"><!-- *ngIf="taskForm.name.$dirty && taskForm.name.$invalid">
              Bitte geben Sie einen Tasktitel ein.
            </span>
            -->
          </ion-item>
          <ion-item class="item item-input item-stacked-label">
            <ion-label stacked>Beschreibung</ion-label>
            <ion-textarea [(ngModel)]="task.description" name="description" ></ion-textarea>
          </ion-item>
          <ion-item class="item item-input item-stacked-label" *ngIf="task.taskType == 'WORKABLE'">
            <ion-label stacked>Zahl der Freiwilligen</ion-label>
            <ion-input type="number" min="0"
                       [(ngModel)]="task.minAmountOfVolunteers" name="minAmountOfVolunteers"></ion-input>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        Zeit und Ort
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-label stacked>Beginn*</ion-label>
            <ion-input type="datetime-local" [(ngModel)]="task.startTime" name="startTime"
                       [ngClass]="{'has-error' : !task.startTime}"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label stacked>Ende</ion-label>
            <ion-input type="datetime-local" [(ngModel)]="task.endTime" name="endTime"></ion-input>
          </ion-item>
          <ion-item>
            <!-- @TODO uncomment when map view is ready
            <button ion-button icon-only (click)="openMap()" item-right>
              <ion-icon name="locate"></ion-icon>
            </button>
            -->
            <ion-label stacked>Adresse
            </ion-label>
            <ion-input type="text" [(ngModel)]="task.address" name="address"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label stacked>Ortsbezeichnung</ion-label>
            <ion-input type="text" [(ngModel)]="task.location" name="location"></ion-input>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ng-template [ngIf]="task.taskType == 'WORKABLE'">
      <collapsible-card>
        <span card-header>
          Kompetenzen <span float-right>{{task.taskCompetences.length || 0}}</span>
        </span>
        <div card-content>
          <ion-list>
            <ion-item  ng-cloak class="no-border-radius">
              <div *ngFor="let competence of competences.all" ng-cloak>
                <!-- @TODO create custom accordion component
                <c-accordion title="competence.name" class="">
                -->
                  <div class="internal-block">
                    <label class="item item-input range">
                      <span class="input-label">Können</span>
                      <input type="range" min="0" max="100" [ngModelOptions]="{standalone: true}"
                             [(ngModel)]="competence.neededProficiencyLevel" (change)="updateCompetence(competence)">
                      <p>{{competence.neededProficiencyLevel}}</p>
                    </label>
                    <label class="item item-input item-toggle">
                      <span class="input-label">Zwingend</span>
                      <label class="toggle toggle-assertive">
                        <input type="checkbox" [(ngModel)]="competence.mandatory" [ngModelOptions]="{standalone: true}">
                        <div class="track">
                          <div class="handle"></div>
                        </div>
                      </label>
                    </label>
                    <button type="button" (click)="removeCompetence(competence)"
                            class="button button-full button-assertive ion-ios-trash-outline no-border-radius">
                      Löschen
                    </button>
                  </div>
                <!--
                </c-accordion>
                -->
              </div>

              <!--<custom-accordion>
                <custom-accordion-head>
                  <div class="item item-divider ion-plus">
                    Kompetenz hinzufügen
                  </div>
                </custom-accordion-head>
                <custom-accordion-body>-->
                  <label class="item item-input item-select">
                    <div class="input-label">
                      Kompetenzbereich*
                    </div>
                    <select [(ngModel)]="competenceArea" name="competenceArea" (change)="onCompetenceAreaChange(competenceArea)">
                      <option *ngFor="let area of competenceAreaList" [ngValue]="area.id">
                        area.name
                      </option>
                    </select>
                  </label>
                  <label class="item item-input item-select" *ngIf="competenceArea != -1">
                    <div class="input-label">
                      Kompetenz*
                    </div>
                    <select [(ngModel)]="competences.newObj.id" name="competence">
                      <option *ngFor="let competence of availableCompetences" [ngValue]="competence.id">
                        {{ competence.name }}
                      </option>
                    </select>
                  </label>
                  <div>


                  </div>
                  <label class="item item-input range">
                    <span class="input-label">Können*</span>
                    <input type="range" min="0" max="100" name="neededProficiencyLevel"
                           [(ngModel)]="competences.newObj.neededProficiencyLevel">
                    <p>{{competences.newObj.neededProficiencyLevel}}</p>
                  </label>

                  <div class="item item-toggle">
                    Zwingend
                    <label class="toggle toggle-assertive">
                      <input type="checkbox" name="mandatory" [(ngModel)]="competences.newObj.mandatory">
                      <div class="track">
                        <div class="handle"></div>
                      </div>
                    </label>
                  </div>
                  <div>
                    <!--<span>-->
                    <!--<i class="ion-information-circled"></i>-->
                    <!--<span>-->
                    <!--Die Kategorie &bdquo;Wichtigkeit&ldquo; bezieht sich auf die Aufgabe, wie wichtig diese für mich ist-->
                    <!--bzw. für das Gelingen des Projekts.-->
                    <!--</span>-->
                    <!--</span>-->

                  </div>
                  <label>*Pflichtfelder</label>
                  <button type="button" (click)="addCompetence()" class="button button-block button-positive ion-plus no-border-radius"> Hinzufügen</button>
              <!--
                </custom-accordion-body>
              </custom-accordion>
              -->
            </ion-item>
          </ion-list>
        </div>
      </collapsible-card>
      <collapsible-card>
        <span card-header>
          Schichten <span float-right>{{task.childTasks.length}}</span>
        </span>
        <div card-content>

        </div>
      </collapsible-card>
      <collapsible-card>
        <span card-header>
          Materialien <span float-right>{{task.materials.length}}</span>
        </span>
        <div card-content>

        </div>
      </collapsible-card>
    </ng-template>
  </form>
</ion-content>

<!--

  <ion-footer-bar>
    <div class="button-bar">
      <button ng-click="delete()" ng-if="showDelete"  class="button button-small button-full no-border-radius button-assertive ion-trash-a"> Löschen </button>
      <button ng-click="save_and_unpublish()"   ng-if="showUnpublish" class="button button-small button-full no-border-radius button-positive ion-eye-disabled"> Zurückziehen </button>
      <button ng-click="save_and_publish()"   ng-if="showPublish" class="button button-small button-full no-border-radius button-balanced ion-eye"> Veröffentlichen </button>
    </div>
  </ion-footer-bar>
</ion-view>
-->
